require 'open-uri'
require 'active_support/core_ext/hash/conversions'

ids=[
  'ashika.sango.vnky0305',
  '106679463949032185522',
  '102902041024770157198',
  '114771695986673650767',
  '112440185587517793628',
  '100357495972153858691',
  '105359223262992613453',
  '114625066696506496646',
  '115811711635215119300',
  '114035269981782045994',
  '104217891673610282881',
  '107517240843468517239',
  '6061476421903196737',
  '108004683230954967896',
  '101161434094110516230',
  '109592715714879828512',
  '106527423592569985031',
  '117037325517046187861',
  '103406754517492444784',
  '112578462044107953538',
  'imayau3',
  'ohyama.321.eufo',
  'kucc.photo.2009',
  'kuro.tour1',
  'kucc.photo.2008',
  'njun.greece',
  'nishimura621',
  'y01.narita',
  'kuro.tour2',
  'kucc.web.album',
  '2.ken.me',
  'kago.photo.a',
  'lunatictemp',
  'T.KASADON',
  'over.the.night.sky',
  'perceptproon',
  'NeoSuneo',
  'ssso.andy',
  'ike3196',
  'Ryoden.Yuta',
  'hanaaai',
  'njkazuo',
  'm.mupata',
  'tomato.banana.kiwi',
  'OGISO.CYCLING',
  'yoneda.nara',
  'imayau',
  'flarekanon',
  't.dotadota',
  '103698838754303137820',
  'moyo0428',
  'imayau2',
  'dreamwaver1017',
  'kuccphoto2011',
  'yasuhiro.yabuuti',
  '100636863090895823868',
  '111897056298182979743',
  '105340911656791770266',
  '103789573935494104373',
  '104233294708928895511',
  '101432773461468347439',
  '102307029042398396208',
  '105184860361655133876',
  '101346018516456409490',
  'kuccphoto2010',
  '114667427270475120024',
  '103324372897856056270',
  '108325904436422239508',
  '108643533599877153930',
  '116400749270788944479',
  'lunaticstraycat',
  'llewrewolf',
  '116907611770791335947',
  'kuccobogkai',
  '102064307558220693421',
  '102266392024661357284',
  '106631600322530207706',
  '116194681317058007196',
  '115315757966361434816',
  '109443080836142598160',
  '116927199419351089605',
  '106613369910775667292',
  '105390204073597852235',
  '111223672814113308598',
  '116495393337791636830',
  '108006320976410388579',
  '105457273353827748424',
  '118085705496983796279',
  'hsudnr01',
  'hsudnr02',
  'hsudnr03',
  'hsudnr04',
  'hsudnr05',
  'hsudnr06',
  'hsudnr07',
  'hsudnr08',
  '111521380200679836503',
  '110797655009381332030',
  '114300190828293651863',
  '108570853812709293646',
  '117567500719559926863',
  'qwerty6asdfgh7zxcvbn8',
  't.furuichi.libra',
  '108627143628677215817',
  '111937120565761488573',
  '115907561501565573340',
  '108146206867856770538',
  '111943550322430240445',
  '5934415042972542225',
  '113593061073742044288',
  '109810150729587520469',
  '117098313366248095484',
  '102582750519853273924',
  '102292752016037693226',
  '108402441859716954568',
  '113281974474253504817',
  '104086310814826228900',
  '114284791816571337561',
  '112020719889679023844',
  '114512654453521761938',
  '115460024059462015978',
  '108920692872706654078',
  '103061642354429605583',
  '107884689343530610586',
  '105524690235511805250',
  '102967193266075022150',
  '117218371180534913831',
  '111989506782211955015',
  '105803818578429949348',
  '103875078807201569995',
  '104686515320175147514',
  '117011703954011703954',
  '117039540229506356507',
  '101303479912569743199',
  '117609164723326624362',
  '101472613929297270382',
  '110766098650897391903',
  '115930793337550269981',
  '110700677201338425326',
  '102977455000807535216',
  '106661404048902983257',
  '104172602187535462971',
  '117914179410083498372',
  '116452329699826683878',
  '103797843061094420518',
  '117283897898033237086',
  '117024535757919902466',
  '106005842965836832260',
  '115228519084807500674',
  '117263078553287461854',
  '107856392651206274896',
  '101789004687109216019',
  '110109497372223282109',
  '111033334577805272056',
  '109225801358219703616',
  '113323775654387489605',
  '107740716534765818658',
  '110414347456434611553'
]

class Album
  attr_accessor :title,:time,:thumbnail,:author,:num,:link
end

as=[]
ids.each do |id|
  begin
    open("https://picasaweb.google.com/data/feed/api/user/#{id}?kind=album") do |s|
      es=Hash.from_xml(s.read)['feed']['entry']
      if es[0]
        es.each do |e|
          next if e['albumType']=='ProfilePhotos'
          a=Album.new
          a.title=e['title']
          a.time=e['published'].gsub("T"," ").gsub(".000Z","")
          a.thumbnail=e['group']['thumbnail']['url']
          a.author=e['author']['name']
          a.num=e['numphotos']
          a.link=e['link'][1]['href']
          as.push a
        end
      else
        e=es
        next if e['albumType']=='ProfilePhotos'
        a=Album.new
        a.title=e['title']
        a.time=e['published'].gsub("T"," ").gsub(".000Z","")
        a.thumbnail=e['group']['thumbnail']['url']
        a.author=e['author']['name']
        a.num=e['numphotos']
        a.link=e['link'][1]['href']
        as.push a
      end
    end
    puts "Done parsing: #{id}"
  rescue => e
    puts "#{e.message} : #{id}"
  end
end
total=as.length
int=1
as.each do |a|
  res = Net::HTTP.post_form(URI.parse('http://new.kuccweb.com/migrate'),
    {
    'title' => a.title,
    'time' => a.time,
    'thumbnail' => a.thumbnail,
    'author' => a.author,
    'num' => a.num,
    'link' => a.link
    })
  if res.code.to_i==200
    puts "Done submitting: #{int}/#{total}"
  else
    puts res.code
  end
  int+=1
end
